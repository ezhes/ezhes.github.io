<!doctype html><html lang=en><head><title>Raspberry Pi IOT Air Conditioner :: Ezhes — tale of the tailed z</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Why The heating and cooling system in my house works well everywhere except my bedroom. In the summer the temperature can reach over 100°F and in the winter it can drop below 50°F. In an effort to make it more bearable, we picked up an LG LP1415SHR air conditioner, and man did it work. There was, of course, one major problem: I couldn&amp;rsquo;t control it from the comfort of my bed!"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://ezh.es/blog/2018/06/raspberry-pi-iot-air-conditioner/><link rel=stylesheet href=https://ezh.es/blog/assets/style.css><link rel=stylesheet href=https://ezh.es/blog/assets/pink.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://ezh.es/blog/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://ezh.es/blog/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="ezhes_"><meta name=twitter:creator content="Allison Husain"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Raspberry Pi IOT Air Conditioner :: Ezhes"><meta property="og:description" content="Why The heating and cooling system in my house works well everywhere except my bedroom. In the summer the temperature can reach over 100°F and in the winter it can drop below 50°F. In an effort to make it more bearable, we picked up an LG LP1415SHR air conditioner, and man did it work. There was, of course, one major problem: I couldn&amp;rsquo;t control it from the comfort of my bed!"><meta property="og:url" content="https://ezh.es/blog/2018/06/raspberry-pi-iot-air-conditioner/"><meta property="og:site_name" content="Raspberry Pi IOT Air Conditioner"><meta property="og:image" content="https://ezh.es/blog/favicon.ico"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2018-06-20 12:56:00 +0700 +0700"></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/blog><div class=logo>Ʒ</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=https://github.com/shusain93>Github</a></li><li><a href=https://twitter.com/ezhes_>Twitter</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=https://github.com/shusain93>Github</a></li><li><a href=https://twitter.com/ezhes_>Twitter</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://ezh.es/blog/2018/06/raspberry-pi-iot-air-conditioner/>Raspberry Pi IOT Air Conditioner</a></h1><div class=post-meta><span class=post-date>2018-06-20</span>
<span class=post-author>::
Allison Husain</span></div><span class=post-tags>#<a href=https://ezh.es/blog/tags/hardware/>hardware</a>&nbsp;
#<a href=https://ezh.es/blog/tags/iot/>iot</a>&nbsp;</span><div class=post-content><div><center><video autoplay loop=loop muted style=width:100%;height:auto>
<source src=/blog/images/ac_pi/headline_video_480p.mov type=video/mp4></video></center><h2 id=why>Why<a href=#why class=hanchor arialabel=Anchor>&#8983;</a></h2><p>The heating and cooling system in my house works well everywhere <em>except</em> my bedroom. In the summer the temperature can reach over 100°F and in the winter it can drop below 50°F. In an effort to make it more bearable, we picked up an LG LP1415SHR air conditioner, and <em>man did it work</em>. There was, of course, one major problem: I couldn&rsquo;t control it from the comfort of my bed!</p><p>This model does come with a remote however it always existed in one of three useless states: out of reach, not charged, or simply missing altogether. Even when I had the remote, the infrared signal didn&rsquo;t reliably reach and so I had to drag myself out of bed to mess with it. Worst of all, I couldn&rsquo;t yell at any of my smart home devices to control it! Simply unacceptable!</p><h2 id=the-project>The project<a href=#the-project class=hanchor arialabel=Anchor>&#8983;</a></h2><p>All jokes aside, I wanted a way to control my AC unit over the internet using a Raspberry Pi. Once it&rsquo;s on the internet, I could do just about anything I wanted—from integration with my Echos to smart scheduling— in a way I was comfortable with.</p><h2 id=parts-list>Parts list<a href=#parts-list class=hanchor arialabel=Anchor>&#8983;</a></h2><ul><li>Raspberry Pi (whatever version, will not be stressing the processor too much)</li><li>An infrared emitter/receiver</li><li>An air conditioner and an infrared remote (in my case the LP1415SHR)</li><li>A temperature sensor (optional, but makes the system &ldquo;smarter&rdquo;)</li></ul><h2 id=assembly>Assembly<a href=#assembly class=hanchor arialabel=Anchor>&#8983;</a></h2><p>There really isn&rsquo;t much in the way of wiring here.</p><p><img src=/blog/images/ac_pi/board_layout.JPG alt=breadboard></p><p>Connect the infrared emitter and receiver (not pictured) to power and a free pin on the Raspberry Pi. Remember (or write down) the pin number. I also make use of an Arduino micro here because I only have an analog TMP35 sensor on hand and so if you don&rsquo;t use/have a digital sensor you won&rsquo;t need it. You can likely skip the breadboard all together and just attach the emitter with a long wire so long as you don&rsquo;t have any extra sensors.</p><p>Once everything is in place, mount the board somewhere with direct line of sight to the IR receiver on the AC unit. If possible, ensure that neither the emitter or receiver are in direct sunlight.</p><h2 id=programming-the-remote-lirc>Programming the remote (LIRC)<a href=#programming-the-remote-lirc class=hanchor arialabel=Anchor>&#8983;</a></h2><p>The easiest way to control IR LEDs on Linux is to use <code>lirc</code>. To install it you can follow these instructions <a href=https://gist.github.com/prasanthj/c15a5298eb682bde34961c322c95378b>here</a>.</p><p>I searched around for a while for LIRC remote files for this air conditioner but didn&rsquo;t find anything and so I had to create my own. This proved difficult, however, because the remote protocol for this air conditioner is very large. Instead of operating like a standard TV remote which just sends a volume up command (around ten pulses usually), my remote sends the <em>entire configuration on every button press</em> (147 pulses). This meant that every time I raised the temperature, the remote also transmitted the fan speed, swing state, mode, auto clean state, and probably even more options that I don&rsquo;t know about.</p><p>I couldn&rsquo;t, therefore, use <code>irrecord</code> (a LIRC tool which can be used to record IR commands) so I instead had to craft my configuration by hand. The config file itself is very picky about whitespace so I recommend you simply download the example at the end, however you can record long codes by doing the following:</p><ol><li>Configure the remote control to the settings you want</li><li>Turn the remote off</li><li>Run <code>mode2 -m -d /dev/lirc0</code></li><li>Point the remote at your receiver, and then turn the remote on</li></ol><p>At this point you should have a large block of numbers which you can copy into the configuration (in the same format as the others).</p><p>To setup the configuration I provide: download and save it at <code>/etc/lirc/lircd.conf</code>, run <code>service lircd restart</code> and then <code>service lircd status</code> to make sure everything loaded correctly.</p><p>The provided config has the following commands already:</p><ul><li>ON_COOL_F3_65_CLEAN</li><li>ON_COOL_F3_70_CLEAN</li><li>ON_COOL_F2_70_CLEAN</li><li>ON_COOL_F1_70_CLEAN</li><li>ON_COOL_F1_70</li><li>POWER_OFF</li><li>ON_HEAT_F1_74_CLEAN</li><li>ON_HEAT_F2_74_CLEAN</li><li>ON_HEAT_F3_74_CLEAN</li></ul><p>These will be available in the configuration file linked at the end however if you need more you can easily add them.</p><p>Once you have installed the configuration correctly and reloaded lirc, you can execute any of these by simply running <code>irsend SEND_ONCE LG_AC &lt;THE_COMMAND_YOU_WANT></code>. If all goes well you should be able to turn on and off your air conditioner as well as set the temperature and fan speed.</p><p>At this point, you should be able to control your unit from the comfort of the linux shell. While I do live at my desk, I think we can all agree that <code>ssh</code>ing into a Pi is not the most convenient way to turn on the heat.</p><h2 id=putting-it-on-the-internet>Putting it on the internet<a href=#putting-it-on-the-internet class=hanchor arialabel=Anchor>&#8983;</a></h2><center><img src=/blog/images/ac_pi/web_server.png height=480 style=height:480px;width:unset></center><p>Now for the fun part! I tossed together a quick python web server which, while not beautiful in the least, gives access to all the controls I need. The code for the web app will be included as well, ripe for the tweaking.</p><p>The API is quite simple, just send a <code>GET</code> request to <code>http://&lt;web_server>:&lt;port>/&lt;REMOTE_CONTROL_COMMAND</code>. Command names are case sensitive so be sure to use the exact command name as is in <code>lircd.conf</code>. The server will always respond with &ldquo;OK&rdquo; (whether or not the command had an effect) to let the caller know the command was received and processed.</p><p>As a note, the API is totally unsecured by default. There are no tokens, passwords, or keys restricting API usage nor does it support TLS. I set out to create an IOT device and truly did, didn&rsquo;t I?</p><p>Jokes aside, I intend for you to implement authentication and encryption on the network border, such as with a reverse proxy. In my case I have an nginx reverse proxy which handles TLS and provides authentication through a username and password for all of my sites. <a href=https://www.linode.com/docs/web-servers/nginx/use-nginx-reverse-proxy/>Linode&rsquo;s guide on this is a great resource for setting this up</a>.</p><h2 id=extensions>Extensions<a href=#extensions class=hanchor arialabel=Anchor>&#8983;</a></h2><p>I took this project a bit further and integrated it with my <a href=https://grafana.com/>Grafana</a> instance so I can see historical, minute by minute temperatures of my bedroom right alongside many of my other metrics. This will (unfortunately) be left as an exercise to the reader as there is a lot of setup, however I do encourage the savvy to check it out because the data is very useful.</p><p><img src=/blog/images/ac_pi/grafana.png alt=breadboard></p><h2 id=downloads>Downloads<a href=#downloads class=hanchor arialabel=Anchor>&#8983;</a></h2><ul><li><p><a href=/blog/images/ac_pi/lircd.conf>LIRC LP1415SHR configuration: lircd.conf</a></p></li><li><p><a href=/blog/images/ac_pi/aircon_server.py>Web server/API: aircon_server.py</a></p></li></ul></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://ezh.es/blog/2020/08/rubber-stamped-forging-spf-and-dmarc-to-send-mail-as-any-gmail-or-g-suite-customer/><span class=button__icon>←</span>
<span class=button__text>Rubber Stamped: Forging SPF and DMARC to send mail as any Gmail or G Suite customer</span></a></span>
<span class="button next"><a href=https://ezh.es/blog/1/01/benchmarking-popular-markdown-parsers-on-ios/><span class=button__text>Benchmarking Popular Markdown Parsers on iOS</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2021 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://ezh.es/blog/assets/main.js></script><script src=https://ezh.es/blog/assets/prism.js></script></div></body></html>